let score1 = ['<div class="tenor-gif-embed" data-postid="16123874" data-share-method="host" data-aspect-ratio="1.92771" data-width="100%"><a href="https://tenor.com/view/outstanding-daniel-betts-prince-ernst-the-crown-excellent-gif-16123874">Outstanding Daniel Betts GIF</a>from <a href="https://tenor.com/search/outstanding-gifs">Outstanding GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>', '<div class="tenor-gif-embed" data-postid="23393280" data-share-method="host" data-aspect-ratio="1.78771" data-width="100%"><a href="https://tenor.com/view/clap-hands-applause-please-satisfied-gif-23393280">Clap Hands GIF</a>from <a href="https://tenor.com/search/clap-gifs">Clap GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>', '<div class="tenor-gif-embed" data-postid="6124403" data-share-method="host" data-aspect-ratio="1.9084" data-width="100%"><a href="https://tenor.com/view/genius-you-are-a-genius-motivation-self-esteem-motivate-gif-6124403">Genius You Are A Genius GIF</a>from <a href="https://tenor.com/search/genius-gifs">Genius GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>', '<div class="tenor-gif-embed" data-postid="25268357" data-share-method="host" data-aspect-ratio="1.77778" data-width="100%"><a href="https://tenor.com/view/office-michael-scott-dwight-raise-gif-25268357">Office Michael GIF</a>from <a href="https://tenor.com/search/office-gifs">Office GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>', '<div class="tenor-gif-embed" data-postid="24481896" data-share-method="host" data-aspect-ratio="2.38806" data-width="100%"><a href="https://tenor.com/view/kung-fu-panda-gif-24481896">Kung Fu Panda GIF</a>from <a href="https://tenor.com/search/kung+fu+panda-gifs">Kung Fu Panda GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>', '<div class="tenor-gif-embed" data-postid="25495626" data-share-method="host" data-aspect-ratio="1.81818" data-width="100%"><a href="https://tenor.com/view/flags-of-the-world-gif-25495626">Flags Of The World GIF</a>from <a href="https://tenor.com/search/flags+of+the+world-gifs">Flags Of The World GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>']
let score2 = ['<div class="tenor-gif-embed" data-postid="26250646" data-share-method="host" data-aspect-ratio="1.42857" data-width="100%"><a href="https://tenor.com/view/tom-cruise-ok-ok-tom-cruise-tom-cruise-thumb-thumbs-up-thumb-up-tom-cruise-gif-26250646">Tom Cruise Ok Ok Tom Cruise GIF</a>from <a href="https://tenor.com/search/tom+cruise+ok-gifs">Tom Cruise Ok GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>', '<div class="tenor-gif-embed" data-postid="13432833" data-share-method="host" data-aspect-ratio="1.77778" data-width="100%"><a href="https://tenor.com/view/jang-wonyoung-thumbs-up-good-job-great-gif-13432833">Jang Wonyoung GIF</a>from <a href="https://tenor.com/search/jang-gifs">Jang GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>', '<div class="tenor-gif-embed" data-postid="21785034" data-share-method="host" data-aspect-ratio="1.86047" data-width="100%"><a href="https://tenor.com/view/welldone-gif-21785034">Welldone GIF</a>from <a href="https://tenor.com/search/welldone-gifs">Welldone GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>', '<div class="tenor-gif-embed" data-postid="18070844" data-share-method="host" data-aspect-ratio="1.77778" data-width="100%"><a href="https://tenor.com/view/impressed-clapping-simon-cowell-agt-gif-18070844">Impressed Clapping GIF</a>from <a href="https://tenor.com/search/impressed-gifs">Impressed GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>', '<div class="tenor-gif-embed" data-postid="21460074" data-share-method="host" data-aspect-ratio="1.31148" data-width="100%"><a href="https://tenor.com/view/gg-good-game-gif-21460074">Gg Good Game GIF</a>from <a href="https://tenor.com/search/gg-gifs">Gg GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>']
let score3 = ['<div class="tenor-gif-embed" data-postid="21771127" data-share-method="host" data-aspect-ratio="1.78771" data-width="100%"><a href="https://tenor.com/view/madagascar-gloria-dont-give-up-hope-madagascar-escape2africa-motivational-gif-21771127">Madagascar Gloria GIF</a>from <a href="https://tenor.com/search/madagascar-gifs">Madagascar GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>', '<div class="tenor-gif-embed" data-postid="10463781" data-share-method="host" data-aspect-ratio="1.33333" data-width="100%"><a href="https://tenor.com/view/dragons-den-keep-going-yes-supportive-you-can-do-it-gif-10463781">You Can Do It GIF</a>from <a href="https://tenor.com/search/dragons+den-gifs">Dragons Den GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>', '<div class="tenor-gif-embed" data-postid="25132328" data-share-method="host" data-aspect-ratio="2.22222" data-width="100%"><a href="https://tenor.com/view/the-office-michael-scott-pam-pam-beesly-its-ok-gif-25132328">The Office Michael Scott GIF</a>from <a href="https://tenor.com/search/the+office-gifs">The Office GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>', '<div class="tenor-gif-embed" data-postid="19056372" data-share-method="host" data-aspect-ratio="1.78771" data-width="100%"><a href="https://tenor.com/view/its-time-to-practice-kanan-gill-lets-practice-lets-train-lets-start-training-gif-19056372">Its Time To Practice Kanan Gill GIF</a>from <a href="https://tenor.com/search/its+time+to+practice-gifs">Its Time To Practice GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>', '<div class="tenor-gif-embed" data-postid="5428691" data-share-method="host" data-aspect-ratio="1.375" data-width="100%"><a href="https://tenor.com/view/kinda-sorta-meh-gif-5428691">Kinda Sorta GIF</a>from <a href="https://tenor.com/search/kinda-gifs">Kinda GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>']
let score4 = ['<div class="tenor-gif-embed" data-postid="23066448" data-share-method="host" data-aspect-ratio="2.0915" data-width="100%"><a href="https://tenor.com/view/office-gif-23066448">Office GIF</a>from <a href="https://tenor.com/search/office-gifs">Office GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>', '<div class="tenor-gif-embed" data-postid="14539725" data-share-method="host" data-aspect-ratio="1.95122" data-width="100%"><a href="https://tenor.com/view/shrug-awkward-welp-oh-well-sigh-gif-14539725">Shrug Awkward GIF</a>from <a href="https://tenor.com/search/shrug-gifs">Shrug GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>', '<div class="tenor-gif-embed" data-postid="12724953" data-share-method="host" data-aspect-ratio="1.77778" data-width="100%"><a href="https://tenor.com/view/garbage-kevin-office-bad-like-eating-garbage-gif-12724953">Garbage Kevin GIF</a>from <a href="https://tenor.com/search/garbage-gifs">Garbage GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>', '<div class="tenor-gif-embed" data-postid="15257425" data-share-method="host" data-aspect-ratio="1.36752" data-width="100%"><a href="https://tenor.com/view/mmm-mmm-harold-brutalmoose-bad-taste-vintage-gif-15257425">Mmm Mmm Harold GIF</a>from <a href="https://tenor.com/search/mmm+mmm-gifs">Mmm Mmm GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>', '<div class="tenor-gif-embed" data-postid="21891680" data-share-method="host" data-aspect-ratio="1.77778" data-width="100%"><a href="https://tenor.com/view/tryagain-jmj-gif-21891680">Tryagain Jmj GIF</a>from <a href="https://tenor.com/search/tryagain-gifs">Tryagain GIFs</a></div> <script type="text/javascript" async src="https://tenor.com/embed.js"></script>']

var score = sessionStorage.getItem('scoreCache')
var amount = sessionStorage.getItem('amountCache')
let gif = document.getElementById('gif')

var percentage = score / amount;
var shareButton = document.getElementById('download-button')

//display different share icons depending on the mobile operating system (iOS share icon on Apple devices, default share icon on all other devices)
if (navigator.platform === "iPhone" || navigator.platform === "iPad" || navigator.platform === "iPod") {
  shareButton.innerHTML = "<img src='styles/shareIcon.png' class='imgIcon'> Share ";
}

else {
  shareButton.innerHTML = "<img src='styles/AndroidShareIcon.png' class='imgIcon'> Share ";
}
                if (percentage > 0.75) {
                  // generate a random index
const randomIndex = Math.floor(Math.random() * score1.length);

// access the element at the random index
const randomElement = score1[randomIndex];
var message = 'Congrats!'
displayConfetti()
gif.innerHTML = randomElement
                } else if (percentage > 0.5) {
                  // generate a random index
const randomIndex = Math.floor(Math.random() * score2.length);

// access the element at the random index
const randomElement = score2[randomIndex];
                  var message = "But there is still room for improvement!";
                  displayConfetti()
                  gif.innerHTML = randomElement
                 
                } else if (percentage > 0.2) {
                  // generate a random index
const randomIndex = Math.floor(Math.random() * score3.length);

// access the element at the random index
const randomElement = score3[randomIndex];
                  var message = "Keep on practicing, you will get better!";
                  gif.innerHTML = randomElement

                } else if (percentage < 0.2) {
                  // generate a random index
const randomIndex = Math.floor(Math.random() * score4.length);

// access the element at the random index
const randomElement = score4[randomIndex];
                  var message = "But don't worry, everyone started small";
                  gif.innerHTML = randomElement
                }

                let resultFinish = document.getElementById("message");
                resultFinish.innerHTML =
                  "You got " +
                  score +
                  " out of " +
                  amount +
                  " Flags correct. " +
                  message;
                resultFinish.style.color = "white";

// Create a function that creates a square image
function createImage() {

  const gameMode = sessionStorage.getItem("myStringKey");
  console.log(gameMode);

  const heading = sessionStorage.getItem('gameMode')
  console.log(heading)
  const scoreCache = sessionStorage.getItem("scoreCache");
  console.log(scoreCache);
  const amountCache = sessionStorage.getItem("amountCache");
  console.log(amountCache);

  // Create a canvas element
  const canvas = document.createElement('canvas');
  canvas.width = 700;
  canvas.height = 700;

  // Get the 2D rendering context
  const ctx = canvas.getContext('2d');

  // Load the template image
  const image = new Image();
  image.setAttribute('crossorigin', 'anonymous');

  if (gameMode === "usa") {
    image.src = 'https://what-the-flag-csv.pages.dev/finishTemplate.png';
  } else if (gameMode === "canada") {
    image.src = 'https://what-the-flag-csv.pages.dev/finishTemplate.png';
  } else if (gameMode === "australia") {
    image.src = 'https://what-the-flag-csv.pages.dev/finishTemplate.png';
  } else if (gameMode === "germany") {
    image.src = 'https://what-the-flag-csv.pages.dev/finishTemplate.png';
  } else if (gameMode === "japan") {
    image.src = 'https://what-the-flag-csv.pages.dev/finishTemplate.png';
  } else {
    image.src = 'https://what-the-flag-csv.pages.dev/finishTemplate.png';
  }

  image.onload = function () {
    // Draw the template image on the canvas
    ctx.drawImage(image, 0, 0, canvas.width, canvas.height);

    // Define the maximum font size
    const maxFontSize = 80;

    // Define the text strings
    const text1 = "I got " + scoreCache + " out of " + amountCache + " " + heading;
    const text2 = 'correct in "What the Flag"';

    // Determine the font size that fits both text strings inside the canvas
    let fontSize = maxFontSize;
    while (true) {
      // Set the font size and calculate the text widths
      ctx.font = fontSize + "px Arial";
      const text1Width = ctx.measureText(text1).width;
      const text2Width = ctx.measureText(text2).width;

      // If both text strings fit inside the canvas, break the loop
      if (text1Width < canvas.width && text2Width < canvas.width) {
        break;
      }

      // Decrease the font size and try again
      fontSize--;
    }

    // Center and draw the first text
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(text1, canvas.width / 2, canvas.height / 2 - fontSize / 2);

    // Center and draw the second text
    ctx.fillText(text2, canvas.width / 2, canvas.height / 2 + fontSize / 2);

    // Store the image in the cache
    sessionStorage.setItem('image', canvas.toDataURL());

    // Access the image from the cache and display it in HTML
    const imageElement = document.getElementById('img');
    imageElement.src = sessionStorage.getItem('image');

    // Enable the download button
    document.getElementById('download-button').disabled = false;
  };
}


      // Call the function to create the image
      createImage('Text 1', 'Text 2');

      if (!['Win32', 'MacIntel', 'Linux x86_64', 'Linux i686'].includes(navigator.platform)) {

        // Add a click event handler to the share button
        let shareButton = document.getElementById('download-button');

        shareButton.addEventListener('click', async function() {
          // Get the image from the cache
          const imageData = sessionStorage.getItem('image');
          const imageBlob = await fetch(imageData).then(response => response.blob());
          const imageFile = new File([imageBlob], 'image.png', { type: 'image/png' });
          
          // Use the Web Share API to open the native share menu on mobile devices

          if (navigator.platform === "iPhone" || navigator.platform === "iPad" || navigator.platform === "iPod") {
            if (navigator.share) {
              navigator.share({
                
                files: [imageFile],
              })
                .then(() => console.log('Image shared successfully.'))
                .catch(error => console.log('Error sharing image:', error));
            } else {
              console.log('Web Share API not supported on this browser.');
            }
          } else {
            
            if (navigator.share) {
              navigator.share({
                title: 'What the Flag',
                files: [imageFile],
                text: 'Check out my score in What the Flag!',
              })
                .then(() => console.log('Image shared successfully.'))
                .catch(error => console.log('Error sharing image:', error));
            } else {
              console.log('Web Share API not supported on this browser.');
            }
          }
          

        });
      
      }

else{
        // Add a click event handler to the download button

        let downloadButton = document.getElementById('download-button')
        downloadButton.innerHTML = "<img src='styles/downloadIcon.png' class='imgIcon'> Download Image";
        downloadButton.addEventListener('click', function() {
          // Get the image from the cache
          const imageData = sessionStorage.getItem('image');
  
          // Create a link element and trigger a download of the image
          const link = document.createElement('a');
          link.download = 'image.png';
          link.href = imageData;
          link.click();
        });
}

      // Disable the download button until the image is created
      document.getElementById('download-button').disabled = true;




